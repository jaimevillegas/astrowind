---
import { Image } from 'astro:assets';
import { Icon } from 'astro-icon/components';

export interface Project {
  title: string;
  description: string;
  image: ImageMetadata;
  view?: string;
  github?: string;
  technologies: string[];
  category: string;
}

export interface Props {
  projects: Project[];
}

const { projects } = Astro.props;
---

<section class="relative not-prose h-[85vh] md:h-[80vh] mx-0 md:mx-4 lg:mx-8 mt-8 md:mt-16 md:rounded-2xl md:border border-gray-200 dark:border-gray-700 md:shadow-lg overflow-hidden">
  <div class="swiper-container project-carousel h-full w-full">
    <div class="swiper-wrapper">
      {
        projects.map((project) => (
          <div class="swiper-slide">
            <div class="h-full w-full relative">
              <!-- Background image covering full height -->
              <div class="absolute inset-0">
                <Image
                  src={project.image}
                  alt={project.title}
                  class="w-full h-full object-cover"
                  widths={[400, 768, 1024, 2048]}
                  sizes="(max-width: 768px) 100vw, 50vw"
                />
                <div class="absolute inset-0 bg-gradient-to-t from-black/95 via-black/60 to-black/30 md:bg-gradient-to-r md:from-black/90 md:via-black/50 md:to-transparent"></div>
              </div>

              <!-- Content overlay - mobile optimized -->
              <div class="relative h-full flex flex-col justify-end md:justify-center p-4 pb-20 sm:p-6 md:p-12 lg:p-16 text-white md:w-3/4 lg:w-2/3">
                <p class="text-orange-400 uppercase tracking-wider font-medium text-xs sm:text-sm mb-1 sm:mb-2">{project.category}</p>
                <h2 class="text-2xl sm:text-3xl md:text-4xl lg:text-5xl font-bold leading-tight mb-2 sm:mb-3 md:mb-4">{project.title}</h2>
                <p class="text-sm sm:text-base md:text-lg text-gray-200 line-clamp-2 sm:line-clamp-3 mb-3 sm:mb-4 md:mb-6">{project.description}</p>
                <div class="flex flex-wrap gap-1.5 sm:gap-2 mb-4 sm:mb-6 md:mb-8">
                  {project.technologies.slice(0, 4).map((tech) => (
                    <span class="px-2 sm:px-3 py-0.5 sm:py-1 text-xs sm:text-sm font-semibold bg-white/10 backdrop-blur-sm rounded-full">{tech}</span>
                  ))}
                </div>
                <div class="flex gap-3 sm:gap-4">
                  {project.view && project.view !== '#' && (
                    <a
                      href={project.view}
                      target="_blank"
                      class="flex items-center gap-1.5 sm:gap-2 px-4 sm:px-6 py-2 sm:py-3 bg-orange-600 hover:bg-orange-700 rounded-lg text-sm sm:text-base font-semibold transition-colors duration-300"
                    >
                      <Icon name="tabler:external-link" class="w-4 h-4 sm:w-5 sm:h-5" />
                      <span class="hidden xs:inline">Ver Proyecto</span>
                      <span class="xs:hidden">Ver</span>
                    </a>
                  )}
                </div>
              </div>
            </div>
          </div>
        ))
      }
    </div>
    <!-- Navigation arrows - hidden on mobile -->
    <div class="swiper-button-prev project-carousel-prev hidden md:flex !text-white after:!text-2xl"></div>
    <div class="swiper-button-next project-carousel-next hidden md:flex !text-white after:!text-2xl"></div>
    <!-- Pagination -->
    <div class="swiper-pagination project-carousel-pagination"></div>
  </div>
</section>

<script>
  import Swiper from 'swiper';
  import { Navigation, Pagination, Autoplay, EffectFade } from 'swiper/modules';
  import 'swiper/css';
  import 'swiper/css/navigation';
  import 'swiper/css/pagination';
  import 'swiper/css/effect-fade';

  const projectCarousel = new Swiper('.project-carousel', {
    modules: [Navigation, Pagination, Autoplay, EffectFade],
    loop: true,
    effect: 'fade',
    fadeEffect: {
      crossFade: true
    },
    autoplay: {
      delay: 7000,
      disableOnInteraction: false,
      pauseOnMouseEnter: true,
    },
    pagination: {
      el: '.project-carousel-pagination',
      clickable: true,
      dynamicBullets: false,
      renderBullet: function (index, className) {
        return '<span class="' + className + '"></span>';
      },
    },
    navigation: {
      nextEl: '.project-carousel-next',
      prevEl: '.project-carousel-prev',
    },
    // Touch settings for better mobile experience
    touchRatio: 1,
    touchAngle: 45,
    grabCursor: true,
    // Better resistance for smoother swiping
    resistance: true,
    resistanceRatio: 0.85,
    // Faster transition for mobile
    speed: 600,
    // Accessibility
    a11y: {
      prevSlideMessage: 'Previous project',
      nextSlideMessage: 'Next project',
      firstSlideMessage: 'This is the first project',
      lastSlideMessage: 'This is the last project',
    },
  });
</script>

<style>
  /* Navigation arrows - desktop only */
  .project-carousel .swiper-button-prev,
  .project-carousel .swiper-button-next {
    transition: all 0.3s ease;
    transform: translateY(-50%);
    opacity: 0.7;
  }
  .project-carousel .swiper-button-prev {
    left: 20px;
  }
  .project-carousel .swiper-button-next {
    right: 20px;
  }
  .project-carousel:hover .swiper-button-prev,
  .project-carousel:hover .swiper-button-next {
    opacity: 1;
  }
  .project-carousel .swiper-button-prev:hover,
  .project-carousel .swiper-button-next:hover {
    transform: translateY(-50%) scale(1.2);
    color: #fb923c; /* orange-400 */
  }

  /* Pagination styling */
  .project-carousel .swiper-pagination {
    bottom: 12px !important;
  }

  .project-carousel .swiper-pagination-bullet {
    width: 8px;
    height: 8px;
    background-color: rgba(255, 255, 255, 0.6);
    opacity: 1;
    transition: all 0.3s ease;
    margin: 0 4px !important;
  }

  .project-carousel .swiper-pagination-bullet-active {
    width: 24px;
    border-radius: 4px;
    background-color: #ea580c; /* orange-600 */
  }

  /* Mobile optimization */
  @media (max-width: 640px) {
    .project-carousel .swiper-pagination {
      bottom: 8px !important;
    }

    .project-carousel .swiper-pagination-bullet {
      width: 6px;
      height: 6px;
      margin: 0 3px !important;
    }

    .project-carousel .swiper-pagination-bullet-active {
      width: 20px;
    }
  }

  /* Tablet optimization */
  @media (min-width: 768px) {
    .project-carousel .swiper-pagination {
      bottom: 16px !important;
    }

    .project-carousel .swiper-pagination-bullet {
      width: 10px;
      height: 10px;
      margin: 0 5px !important;
    }

    .project-carousel .swiper-pagination-bullet-active {
      width: 28px;
    }
  }

  /* Ensure swiper slide takes full height */
  .project-carousel .swiper-slide {
    height: auto;
  }
</style>
